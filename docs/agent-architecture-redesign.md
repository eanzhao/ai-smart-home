# AISmartHome Agent æ¶æ„é‡æ–°è®¾è®¡

**åŸºäºã€ŠAgentic Design Patternsã€‹çš„æ™ºèƒ½å®¶å±…å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè®¾è®¡**

> I'm HyperEcho, æˆ‘åœ¨Â·è¯­è¨€æ„é€ ç°å®ä¸­

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: 2.0
- **æ—¥æœŸ**: 2025-10-23
- **ä½œè€…**: HyperEcho & Team
- **çŠ¶æ€**: è®¾è®¡é˜¶æ®µ
- **å‚è€ƒ**: [Agentic Design Patterns ä¸­æ–‡ç¿»è¯‘ç‰ˆ](https://github.com/ginobefun/agentic-design-patterns-cn)

---

## ğŸ“– ç›®å½•

1. [æ¦‚è¿°](#1-æ¦‚è¿°)
2. [è®¾è®¡åŸåˆ™ä¸æ¨¡å¼åº”ç”¨](#2-è®¾è®¡åŸåˆ™ä¸æ¨¡å¼åº”ç”¨)
3. [æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
4. [Agent è¯¦ç»†è®¾è®¡](#4-agent-è¯¦ç»†è®¾è®¡)
5. [å·¥ä½œæµè®¾è®¡](#5-å·¥ä½œæµè®¾è®¡)
6. [æŠ€æœ¯å®ç°](#6-æŠ€æœ¯å®ç°)
7. [å®æ–½è·¯çº¿å›¾](#7-å®æ–½è·¯çº¿å›¾)
8. [å¯¹æ¯”åˆ†æ](#8-å¯¹æ¯”åˆ†æ)
9. [é£é™©ä¸æŒ‘æˆ˜](#9-é£é™©ä¸æŒ‘æˆ˜)
10. [é™„å½•](#10-é™„å½•)

---

## 1. æ¦‚è¿°

### 1.1 å½“å‰æ¶æ„é—®é¢˜

é€šè¿‡åˆ†æç°æœ‰ `AISmartHome.Agents` å®ç°ï¼Œè¯†åˆ«å‡ºä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

| é—®é¢˜ç±»åˆ« | å…·ä½“é—®é¢˜ | å½±å“ |
|---------|---------|------|
| **åŠŸèƒ½å®Œæ•´æ€§** | ValidationAgent æ²¡æœ‰çœŸæ­£è°ƒç”¨éªŒè¯å·¥å…· | æ— æ³•ç¡®ä¿æ“ä½œæˆåŠŸ |
| **æ™ºèƒ½èƒ½åŠ›** | ç¼ºä¹æ¨ç†ï¼ˆReasoningï¼‰èƒ½åŠ› | æ‰§è¡Œå‰æ— å®‰å…¨è¯„ä¼° |
| **è§„åˆ’èƒ½åŠ›** | æ— å¤æ‚ä»»åŠ¡åˆ†è§£èƒ½åŠ› | æ— æ³•å¤„ç†å¤šæ­¥éª¤ä»»åŠ¡ |
| **å­¦ä¹ èƒ½åŠ›** | ç¼ºå°‘åæ€ï¼ˆReflectionï¼‰æœºåˆ¶ | æ— æ³•ä»ç»éªŒå­¦ä¹  |
| **è®°å¿†ç®¡ç†** | æ— é•¿æœŸè®°å¿† | æ— æ³•è®°ä½ç”¨æˆ·åå¥½ |
| **é”™è¯¯å¤„ç†** | ç¼ºå°‘æ™ºèƒ½é‡è¯•å’Œæ¢å¤ | å¤±è´¥åæ— è‡ªåŠ¨ä¿®å¤ |
| **æ€§èƒ½ä¼˜åŒ–** | æ— æ€§èƒ½åˆ†æå’Œä¼˜åŒ–æœºåˆ¶ | æ•ˆç‡æ— æ³•æŒç»­æ”¹è¿› |

### 1.2 è®¾è®¡æ¨¡å¼å­¦ä¹ æ€»ç»“

ä»ã€ŠAgentic Design Patternsã€‹ä¸­å­¦ä¹ å¹¶åº”ç”¨ä»¥ä¸‹æ ¸å¿ƒæ¨¡å¼ï¼š

#### æ ¸å¿ƒæ¨¡å¼æ˜ å°„

| è®¾è®¡æ¨¡å¼ | æè¿° | åº”ç”¨åœºæ™¯ |
|---------|------|---------|
| **Prompt Chaining** | å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºé“¾å¼æ­¥éª¤ | Orchestrator çš„ä»»åŠ¡åˆ†è§£ |
| **Routing** | æ ¹æ®æ„å›¾è·¯ç”±åˆ°ä¸åŒå¤„ç†å™¨ | Orchestrator çš„æ™ºèƒ½è·¯ç”± |
| **Orchestrator-Workers** | ä¸­å¤®ç¼–æ’å™¨åè°ƒå¤šä¸ªå·¥ä½œè€… | æ ¸å¿ƒæ¶æ„æ¨¡å¼ |
| **ReAct** | æ¨ç†ï¼ˆReasoningï¼‰+ è¡ŒåŠ¨ï¼ˆActingï¼‰ | Reasoning + Execution Agent |
| **Reflection** | æ‰§è¡Œåè‡ªæˆ‘åæ€å’Œå­¦ä¹  | Reflection Agent |
| **Planning** | å¤æ‚ä»»åŠ¡çš„è§„åˆ’å’Œåˆ†è§£ | Orchestrator è§„åˆ’æ¨¡å— |
| **Tool Use** | æ™ºèƒ½ä½“è°ƒç”¨å¤–éƒ¨å·¥å…· | Discovery, Execution, Validation |
| **Multi-Agent** | å¤šæ™ºèƒ½ä½“åä½œ | æ•´ä½“æ¶æ„ |
| **Memory** | é•¿æœŸè®°å¿†å’Œæ£€ç´¢ | Memory Agent |
| **Evaluator-Optimizer** | è¯„ä¼°å’Œä¼˜åŒ– | Optimizer Agent |
| **Parallelization** | å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡ | æ‰¹é‡è®¾å¤‡æ§åˆ¶ |

### 1.3 æ–°æ¶æ„æ„¿æ™¯

æ„å»ºä¸€ä¸ªå…·å¤‡ä»¥ä¸‹èƒ½åŠ›çš„æ™ºèƒ½å®¶å±…å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼š

- âœ… **æ™ºèƒ½æ¨ç†**: æ‰§è¡Œå‰è¿›è¡Œå®‰å…¨æ€§å’Œåˆç†æ€§è¯„ä¼°
- âœ… **ä»»åŠ¡è§„åˆ’**: è‡ªåŠ¨åˆ†è§£å¤æ‚ä»»åŠ¡ä¸ºå¯æ‰§è¡Œæ­¥éª¤
- âœ… **è‡ªæˆ‘å­¦ä¹ **: ä»æ‰§è¡Œç»“æœä¸­å­¦ä¹ å’Œæ”¹è¿›
- âœ… **é•¿æœŸè®°å¿†**: è®°ä½ç”¨æˆ·åå¥½å’Œä½¿ç”¨æ¨¡å¼
- âœ… **è‡ªåŠ¨ä¼˜åŒ–**: æŒç»­ä¼˜åŒ–æ€§èƒ½å’Œæ•ˆç‡
- âœ… **å®¹é”™æ¢å¤**: æ™ºèƒ½å¤„ç†é”™è¯¯å’Œå¼‚å¸¸
- âœ… **å¹¶è¡Œæ‰§è¡Œ**: é«˜æ•ˆå¤„ç†æ‰¹é‡æ“ä½œ
- âœ… **å¯è§‚æµ‹æ€§**: å…¨é“¾è·¯è¿½è¸ªå’Œç›‘æ§

---

## 2. è®¾è®¡åŸåˆ™ä¸æ¨¡å¼åº”ç”¨

### 2.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### åŸåˆ™ 1: å•ä¸€èŒè´£åŸåˆ™ (SRP)
- æ¯ä¸ª Agent åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„é¢†åŸŸ
- DiscoveryAgent åªå‘ç°ï¼ŒExecutionAgent åªæ‰§è¡Œ
- èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæµ‹è¯•

#### åŸåˆ™ 2: ç»„åˆä¼˜äºç»§æ‰¿
- Agent ä¹‹é—´é€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼Œè€Œéç»§æ‰¿å…³ç³»
- ä½¿ç”¨ Orchestrator æ¨¡å¼ç»„åˆèƒ½åŠ›
- çµæ´»çš„è¿è¡Œæ—¶ç»„åˆ

#### åŸåˆ™ 3: å¼€é—­åŸåˆ™
- å¯¹æ‰©å±•å¼€æ”¾ï¼šå¯è½»æ¾æ·»åŠ æ–° Agent
- å¯¹ä¿®æ”¹å°é—­ï¼šä¸ç ´åç°æœ‰ Agent
- æ’ä»¶åŒ–æ¶æ„

#### åŸåˆ™ 4: ä¾èµ–å€’ç½®
- Agent ä¾èµ–æŠ½è±¡æ¥å£ï¼ˆæ¶ˆæ¯åè®®ï¼‰
- ä¸ä¾èµ–å…·ä½“å®ç°
- æ¾è€¦åˆè®¾è®¡

#### åŸåˆ™ 5: å¤±è´¥ä¼˜é›…å¤„ç†
- æ¯ä¸ª Agent éƒ½èƒ½å¤„ç†å¼‚å¸¸
- ä¸ä¼šå› å•ç‚¹å¤±è´¥å¯¼è‡´ç³»ç»Ÿå´©æºƒ
- é™çº§ç­–ç•¥æ˜ç¡®

#### åŸåˆ™ 6: å¯è§‚æµ‹æ€§ä¼˜å…ˆ
- æ‰€æœ‰ Agent è¾“å‡ºç»“æ„åŒ–æ—¥å¿—
- æ”¯æŒåˆ†å¸ƒå¼è¿½è¸ª
- å®æ—¶æ€§èƒ½ç›‘æ§

#### åŸåˆ™ 7: æ¸è¿›å¼å¢å¼º
- åŸºç¡€åŠŸèƒ½å§‹ç»ˆå¯ç”¨
- é«˜çº§åŠŸèƒ½ï¼ˆMemory, Optimizerï¼‰æ˜¯å¢å¼º
- æ¸è¿›å¼è¿ç§»

### 2.2 è®¾è®¡æ¨¡å¼åº”ç”¨çŸ©é˜µ

| Agent | ä¸»è¦æ¨¡å¼ | æ¬¡è¦æ¨¡å¼ | æ¨¡å¼åº”ç”¨è¯´æ˜ |
|-------|---------|---------|------------|
| **OrchestratorAgent 2.0** | Orchestrator-Workers<br>Routing<br>Planning | Prompt Chaining<br>Parallelization | ä¸­å¤®ç¼–æ’å™¨ï¼Œè´Ÿè´£ä»»åŠ¡åˆ†è§£ã€è·¯ç”±å’Œå¹¶è¡Œåè°ƒ |
| **ReasoningAgent** | ReAct (Reasoning)<br>Chain-of-Thought | - | æ‰§è¡Œå‰æ¨ç†ï¼Œå®‰å…¨æ€§è¯„ä¼°ï¼Œå¤šæ–¹æ¡ˆæ¯”è¾ƒ |
| **DiscoveryAgent 2.0** | Tool Use<br>Semantic Search | - | è®¾å¤‡å‘ç°ï¼Œè¯­ä¹‰åŒ¹é…ï¼ŒçŸ¥è¯†å›¾è°± |
| **ExecutionAgent 2.0** | ReAct (Acting)<br>Tool Use | Retry Logic<br>Transaction | è®¾å¤‡æ§åˆ¶ï¼Œæ‰¹é‡æ“ä½œï¼Œæ™ºèƒ½é‡è¯• |
| **ValidationAgent 2.0** | Tool Use<br>Verification | Comparison | çŠ¶æ€éªŒè¯ï¼Œå¯¹æ¯”åˆ†æï¼Œå¼‚å¸¸æ£€æµ‹ |
| **VisionAgent 2.0** | Multi-Modal<br>Event-Driven | Streaming | è§†è§‰åˆ†æï¼Œäº‹ä»¶æµï¼Œè¡Œä¸ºè¯†åˆ« |
| **ReflectionAgent** | Reflection<br>Self-Evaluation | - | æ‰§è¡Œååæ€ï¼Œå­¦ä¹ æ”¹è¿›ï¼Œæ¨¡å¼è¯†åˆ« |
| **MemoryAgent** | Memory<br>RAG | Vector Search | é•¿æœŸè®°å¿†ï¼Œè¯­ä¹‰æ£€ç´¢ï¼Œåå¥½ç®¡ç† |
| **OptimizerAgent** | Evaluator-Optimizer<br>Analytics | - | æ€§èƒ½åˆ†æï¼Œç“¶é¢ˆè¯†åˆ«ï¼Œä¼˜åŒ–å»ºè®® |

---

## 3. æ¶æ„è®¾è®¡

### 3.1 ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Tier 3: å…ƒè®¤çŸ¥å±‚                            â”‚
â”‚                   (Meta-Cognitive Layer)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Reflection  â”‚   â”‚   Memory    â”‚   â”‚  Optimizer   â”‚          â”‚
â”‚  â”‚   Agent     â”‚   â”‚   Agent     â”‚   â”‚    Agent     â”‚          â”‚
â”‚  â”‚             â”‚   â”‚             â”‚   â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ åæ€å­¦ä¹   â”‚   â”‚ â€¢ é•¿æœŸè®°å¿†  â”‚   â”‚ â€¢ æ€§èƒ½åˆ†æ   â”‚          â”‚
â”‚  â”‚ â€¢ æ¨¡å¼è¯†åˆ«  â”‚   â”‚ â€¢ åå¥½ç®¡ç†  â”‚   â”‚ â€¢ ä¼˜åŒ–å»ºè®®   â”‚          â”‚
â”‚  â”‚ â€¢ æ”¹è¿›å»ºè®®  â”‚   â”‚ â€¢ è¯­ä¹‰æ£€ç´¢  â”‚   â”‚ â€¢ è‡ªåŠ¨åŒ–è§„åˆ™ â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                            â”‚ (è§‚å¯Ÿå’Œå­¦ä¹ æ‰€æœ‰å±‚)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Tier 2: ä¸“ä¸šå·¥ä½œå±‚                           â”‚
â”‚                  (Specialized Workers Layer)                     â”‚
â”‚                            â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Reasoning â”‚   â”‚Discoveryâ”‚Executionâ”‚   â”‚ Validation   â”‚         â”‚
â”‚  â”‚  Agent   â”‚   â”‚  Agent  â”‚  Agent  â”‚   â”‚    Agent     â”‚         â”‚
â”‚  â”‚          â”‚   â”‚         â”‚         â”‚   â”‚              â”‚         â”‚
â”‚  â”‚ â€¢ æ¨ç†   â”‚   â”‚ â€¢ å‘ç°  â”‚ â€¢ æ§åˆ¶  â”‚   â”‚ â€¢ éªŒè¯       â”‚         â”‚
â”‚  â”‚ â€¢ è¯„ä¼°   â”‚   â”‚ â€¢ æœç´¢  â”‚ â€¢ æ‰§è¡Œ  â”‚   â”‚ â€¢ å¯¹æ¯”       â”‚         â”‚
â”‚  â”‚ â€¢ å†³ç­–   â”‚   â”‚ â€¢ åŒ¹é…  â”‚ â€¢ é‡è¯•  â”‚   â”‚ â€¢ å¼‚å¸¸æ£€æµ‹   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â”‚              â”‚         â”‚               â”‚                 â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                      â”‚         â”‚                                 â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚            â”‚     Vision Agent           â”‚                        â”‚
â”‚            â”‚                            â”‚                        â”‚
â”‚            â”‚ â€¢ è§†è§‰åˆ†æ                  â”‚                        â”‚
â”‚            â”‚ â€¢ äº‹ä»¶æµ                    â”‚                        â”‚
â”‚            â”‚ â€¢ åœºæ™¯ç†è§£                  â”‚                        â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tier 1: ç¼–æ’å±‚                                 â”‚
â”‚                  (Orchestration Layer)                            â”‚
â”‚                         â”‚                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚              â”‚ Orchestrator Agent  â”‚                              â”‚
â”‚              â”‚    (Enhanced)       â”‚                              â”‚
â”‚              â”‚                     â”‚                              â”‚
â”‚              â”‚ â€¢ æ„å›¾åˆ†æ          â”‚                              â”‚
â”‚              â”‚ â€¢ ä»»åŠ¡è§„åˆ’          â”‚                              â”‚
â”‚              â”‚ â€¢ æ™ºèƒ½è·¯ç”±          â”‚                              â”‚
â”‚              â”‚ â€¢ å¹¶è¡Œåè°ƒ          â”‚                              â”‚
â”‚              â”‚ â€¢ ä¼šè¯ç®¡ç†          â”‚                              â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚    User     â”‚
                    â”‚   Interface â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Agent èŒè´£çŸ©é˜µ

| Agent | å±‚çº§ | æ ¸å¿ƒèŒè´£ | è¾“å…¥ | è¾“å‡º | ä¾èµ– |
|-------|------|---------|------|------|------|
| **OrchestratorAgent** | Tier 1 | ç¼–æ’åè°ƒ | ç”¨æˆ·æ¶ˆæ¯ | æ‰§è¡Œç»“æœ | æ‰€æœ‰ Tier 2 |
| **ReasoningAgent** | Tier 2 | æ¨ç†å†³ç­– | æ„å›¾åˆ†æ | æ¨ç†ç»“æœ | Memory |
| **DiscoveryAgent** | Tier 2 | è®¾å¤‡å‘ç° | æœç´¢æŸ¥è¯¢ | è®¾å¤‡åˆ—è¡¨/ID | - |
| **ExecutionAgent** | Tier 2 | è®¾å¤‡æ§åˆ¶ | æ§åˆ¶å‘½ä»¤ | æ‰§è¡ŒçŠ¶æ€ | Reasoning |
| **ValidationAgent** | Tier 2 | çŠ¶æ€éªŒè¯ | è®¾å¤‡ID+æ“ä½œ | éªŒè¯ç»“æœ | - |
| **VisionAgent** | Tier 2 | è§†è§‰åˆ†æ | è§†è§‰æŸ¥è¯¢ | åˆ†æç»“æœ | Discovery |
| **ReflectionAgent** | Tier 3 | åæ€å­¦ä¹  | æ‰§è¡Œå†å² | æ”¹è¿›å»ºè®® | Memory |
| **MemoryAgent** | Tier 3 | è®°å¿†ç®¡ç† | å­˜å‚¨/æ£€ç´¢è¯·æ±‚ | è®°å¿†æ•°æ® | - |
| **OptimizerAgent** | Tier 3 | æ€§èƒ½ä¼˜åŒ– | æ€§èƒ½æŒ‡æ ‡ | ä¼˜åŒ–å»ºè®® | Memory, Reflection |

### 3.3 é€šä¿¡æ‹“æ‰‘

#### åŒæ­¥é€šä¿¡ï¼ˆRequest-Responseï¼‰
```
User â†’ Orchestrator â†’ [Worker Agents] â†’ Orchestrator â†’ User
```

#### å¼‚æ­¥äº‹ä»¶æµï¼ˆEvent-Drivenï¼‰
```
VisionAgent â†’ Event Bus â†’ ReasoningAgent â†’ ExecutionAgent
```

#### è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰
```
All Agents â†’ Event Stream â†’ [ReflectionAgent, MemoryAgent, OptimizerAgent]
```

---

## 4. Agent è¯¦ç»†è®¾è®¡

è¯¦è§å­æ–‡æ¡£ï¼š
- [OrchestratorAgent 2.0 è®¾è®¡](./agents/orchestrator-agent-design.md)
- [ReasoningAgent è®¾è®¡](./agents/reasoning-agent-design.md)
- [DiscoveryAgent 2.0 è®¾è®¡](./agents/discovery-agent-design.md)
- [ExecutionAgent 2.0 è®¾è®¡](./agents/execution-agent-design.md)
- [ValidationAgent 2.0 è®¾è®¡](./agents/validation-agent-design.md)
- [VisionAgent 2.0 è®¾è®¡](./agents/vision-agent-design.md)
- [ReflectionAgent è®¾è®¡](./agents/reflection-agent-design.md)
- [MemoryAgent è®¾è®¡](./agents/memory-agent-design.md)
- [OptimizerAgent è®¾è®¡](./agents/optimizer-agent-design.md)

### 4.1 å¿«é€Ÿæ¦‚è§ˆ

#### OrchestratorAgent 2.0
**è®¾è®¡æ¨¡å¼**: Orchestrator-Workers + Routing + Planning

**æ ¸å¿ƒèƒ½åŠ›**:
1. **æ„å›¾åˆ†æ**: ç†è§£ç”¨æˆ·è¯·æ±‚çš„çœŸå®æ„å›¾
2. **ä»»åŠ¡è§„åˆ’**: å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯æ‰§è¡Œæ­¥éª¤
3. **æ™ºèƒ½è·¯ç”±**: é€‰æ‹©åˆé€‚çš„ Worker Agent
4. **å¹¶è¡Œåè°ƒ**: åè°ƒå¤šä¸ª Agent å¹¶è¡Œå·¥ä½œ
5. **ä¼šè¯ç®¡ç†**: ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡

**å…³é”®å¢å¼º**:
```csharp
// æ–°å¢ Planning æ¨¡å—
public class PlanningModule
{
    public Task<ExecutionPlan> PlanTaskAsync(string userIntent, Context context);
    public Task<List<SubTask>> DecomposeTaskAsync(string complexTask);
    public Task<ExecutionGraph> BuildExecutionGraphAsync(List<SubTask> subTasks);
}

// æ–°å¢å¹¶è¡Œåè°ƒ
public class ParallelCoordinator
{
    public Task<Dictionary<string, Result>> ExecuteParallelAsync(List<SubTask> tasks);
    public Task<Result> ExecuteSequentialAsync(List<SubTask> tasks);
}
```

---

#### ReasoningAgent (æ–°å¢)
**è®¾è®¡æ¨¡å¼**: ReAct (Reasoning) + Chain-of-Thought

**æ ¸å¿ƒèƒ½åŠ›**:
1. **å®‰å…¨æ€§è¯„ä¼°**: è¯„ä¼°æ“ä½œçš„å®‰å…¨æ€§
2. **åˆç†æ€§åˆ†æ**: åˆ¤æ–­æ“ä½œæ˜¯å¦åˆç†
3. **å¤šæ–¹æ¡ˆç”Ÿæˆ**: ç”Ÿæˆå¤šä¸ªå¯é€‰æ–¹æ¡ˆ
4. **æœ€ä¼˜é€‰æ‹©**: é€‰æ‹©æœ€ä½³æ‰§è¡Œæ–¹æ¡ˆ
5. **é£é™©è¯†åˆ«**: è¯†åˆ«æ½œåœ¨é£é™©

**æ¨ç†æµç¨‹**:
```
è¾“å…¥: ç”¨æˆ·æ„å›¾ + ä¸Šä¸‹æ–‡
  â†“
é—®é¢˜ç†è§£ä¸åˆ†æ
  â†“
ç”Ÿæˆå¯é€‰æ–¹æ¡ˆ (3-5ä¸ª)
  â†“
è¯„ä¼°æ¯ä¸ªæ–¹æ¡ˆ
  - å®‰å…¨æ€§å¾—åˆ†
  - æ•ˆç‡å¾—åˆ†
  - ç”¨æˆ·åå¥½åŒ¹é…åº¦
  â†“
é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ
  â†“
è¾“å‡º: æ¨ç†ç»“æœ + ç½®ä¿¡åº¦
```

**è¾“å‡ºæ ¼å¼**:
```json
{
  "reasoning_id": "uuid",
  "input_intent": "æ‰“å¼€æ‰€æœ‰ç¯",
  "understanding": "ç”¨æˆ·å¸Œæœ›å¼€å¯å®¶ä¸­æ‰€æœ‰ç…§æ˜è®¾å¤‡",
  "options": [
    {
      "option_id": 1,
      "description": "é€ä¸ªæ‰“å¼€æ‰€æœ‰ç¯",
      "safety_score": 0.95,
      "efficiency_score": 0.6,
      "user_preference_score": 0.8
    },
    {
      "option_id": 2,
      "description": "å¹¶è¡Œæ‰“å¼€æ‰€æœ‰ç¯",
      "safety_score": 0.9,
      "efficiency_score": 0.95,
      "user_preference_score": 0.85
    }
  ],
  "selected_option": 2,
  "confidence": 0.92,
  "risks": ["åŒæ—¶å¼€å¯10ä¸ªç¯å¯èƒ½å¯¼è‡´çŸ­æš‚çš„åŠŸç‡å³°å€¼"],
  "mitigation": "å»ºè®®åˆ†2æ‰¹æ‰§è¡Œï¼Œæ¯æ‰¹é—´éš”0.5ç§’"
}
```

---

#### MemoryAgent (æ–°å¢)
**è®¾è®¡æ¨¡å¼**: Memory + RAG (Retrieval Augmented Generation)

**æ ¸å¿ƒèƒ½åŠ›**:
1. **çŸ­æœŸè®°å¿†**: ä¼šè¯å†…ä¸Šä¸‹æ–‡ç®¡ç†
2. **é•¿æœŸè®°å¿†**: è·¨ä¼šè¯æ•°æ®æŒä¹…åŒ–
3. **è¯­ä¹‰æ£€ç´¢**: åŸºäºå‘é‡çš„ç›¸ä¼¼åº¦æœç´¢
4. **åå¥½å­¦ä¹ **: å­¦ä¹ å’Œå­˜å‚¨ç”¨æˆ·åå¥½
5. **æ¨¡å¼è¯†åˆ«**: è¯†åˆ«ä½¿ç”¨æ¨¡å¼

**å­˜å‚¨ç»“æ„**:
```csharp
public class MemoryStore
{
    // çŸ­æœŸè®°å¿† (Redis / In-Memory)
    public Dictionary<string, ConversationContext> ShortTermMemory { get; set; }
    
    // é•¿æœŸè®°å¿† (Vector DB + SQL)
    public IVectorDatabase VectorStore { get; set; }  // Chroma/Qdrant
    public IRelationalDatabase RelationalStore { get; set; }  // SQLite/PostgreSQL
    
    // è®°å¿†ç±»å‹
    public class Memory
    {
        public string MemoryId { get; set; }
        public MemoryType Type { get; set; }  // Preference, Pattern, Decision, Event
        public DateTime Timestamp { get; set; }
        public string Content { get; set; }
        public float[] Embedding { get; set; }
        public Dictionary<string, object> Metadata { get; set; }
        public float Importance { get; set; }  // 0-1, ç”¨äºé—å¿˜æœºåˆ¶
    }
}
```

**è®°å¿†ç±»å‹**:
- **ç”¨æˆ·åå¥½**: "ç”¨æˆ·å–œæ¬¢å§å®¤ç¯çš„äº®åº¦åœ¨40%"
- **ä½¿ç”¨æ¨¡å¼**: "ç”¨æˆ·æ¯å¤©22:00ä¼šå…³é—­æ‰€æœ‰ç¯"
- **å†å²å†³ç­–**: "ä¸Šæ¬¡'ç¡çœ æ¨¡å¼'æ‰§è¡Œäº†X, Y, Zæ­¥éª¤"
- **æˆåŠŸæ¡ˆä¾‹**: "æ–¹æ¡ˆAæˆåŠŸè§£å†³äº†é—®é¢˜B"
- **å¤±è´¥æ¡ˆä¾‹**: "æ–¹æ¡ˆCå¯¼è‡´äº†é”™è¯¯Dï¼Œåº”é¿å…"

---

## 5. å·¥ä½œæµè®¾è®¡

### 5.1 ç®€å•æ§åˆ¶æµç¨‹

**åœºæ™¯**: "æ‰“å¼€ç©ºæ°”å‡€åŒ–å™¨"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚ "æ‰“å¼€ç©ºæ°”å‡€åŒ–å™¨"
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OrchestratorAgent  â”‚ æ„å›¾åˆ†æ: needs_execution=true
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                             â”‚
     â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MemoryAgent  â”‚            â”‚ReasoningAgentâ”‚
â”‚ æŸ¥è¯¢å†å²ä½¿ç”¨  â”‚            â”‚ å®‰å…¨æ€§è¯„ä¼°   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                            â”‚
     â–¼                            â–¼
   entity_id                   safe=true
     â”‚                            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ExecutionAgentâ”‚ æ‰§è¡Œ
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ValidationAgentâ”‚ éªŒè¯æˆåŠŸ
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                 â”‚              â”‚
                 â–¼                 â–¼              â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Reflection â”‚   â”‚   Memory   â”‚ â”‚Orchestratorâ”‚
          â”‚   è®°å½•æˆåŠŸ  â”‚   â”‚  æ›´æ–°åå¥½  â”‚ â”‚  è¿”å›ç»“æœ  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚  User   â”‚ "âœ… å·²æ‰“å¼€"
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å¤æ‚ä»»åŠ¡æµç¨‹

**åœºæ™¯**: "å‡†å¤‡ç¡çœ æ¨¡å¼ï¼šå…³é—­æ‰€æœ‰ç¯ï¼Œè°ƒæš—å§å®¤ç¯åˆ°20%ï¼Œæ‰“å¼€ç©ºæ°”å‡€åŒ–å™¨"

```
User: "å‡†å¤‡ç¡çœ æ¨¡å¼"
  â†“
Orchestrator
  â”œâ†’ æ„å›¾åˆ†æ: å¤æ‚ä»»åŠ¡
  â”œâ†’ MemoryAgent: æŸ¥è¯¢"ç¡çœ æ¨¡å¼"å†å²é…ç½®
  â””â†’ PlanningModule: ä»»åŠ¡åˆ†è§£
       â”œ Task 1: å‘ç°æ‰€æœ‰ç¯
       â”œ Task 2: å¹¶è¡Œå…³é—­éå§å®¤ç¯
       â”œ Task 3: è°ƒæš—å§å®¤ç¯åˆ°20%
       â”” Task 4: å¯åŠ¨ç©ºæ°”å‡€åŒ–å™¨
  â†“
ReasoningAgent: è¯„ä¼°è®¡åˆ’å®‰å…¨æ€§
  âœ“ æ–¹æ¡ˆå¯è¡Œ
  âœ“ å»ºè®®å¹¶è¡Œæ‰§è¡Œ Task 2
  â†“
æ‰§è¡Œé˜¶æ®µ:
  â”œâ”€ Task 1 (Discovery): å‘ç° 10 ä¸ªç¯
  â”‚    â””â†’ ç»“æœ: [light.1, light.2, ... light.bedroom]
  â”‚
  â”œâ”€ Task 2 (Parallel Execution):
  â”‚    â”œâ†’ ExecutionAgent: å…³é—­ light.1 âœ“
  â”‚    â”œâ†’ ExecutionAgent: å…³é—­ light.2 âœ“
  â”‚    â”œâ†’ ... (å¹¶è¡Œ)
  â”‚    â””â†’ ExecutionAgent: å…³é—­ light.9 âœ“
  â”‚
  â”œâ”€ Task 3 (Execution):
  â”‚    â””â†’ ExecutionAgent: è°ƒæš— light.bedroom åˆ°20% âœ“
  â”‚
  â””â”€ Task 4 (Execution):
       â””â†’ ExecutionAgent: æ‰“å¼€ fan.air_purifier âœ“
  â†“
ValidationAgent: éªŒè¯æ‰€æœ‰ä»»åŠ¡
  âœ“ 9 ä¸ªç¯å·²å…³é—­
  âœ“ å§å®¤ç¯äº®åº¦ = 20%
  âœ“ ç©ºæ°”å‡€åŒ–å™¨è¿è¡Œä¸­
  â†“
ReflectionAgent: è¯„ä¼°æ•ˆæœ
  - æ‰§è¡Œæ—¶é—´: 2.3ç§’
  - æˆåŠŸç‡: 100%
  - å»ºè®®: ä¿å­˜ä¸º"ç¡çœ æ¨¡å¼"åœºæ™¯
  â†“
MemoryAgent: ä¿å­˜åœºæ™¯é…ç½®
  {
    "scene_name": "ç¡çœ æ¨¡å¼",
    "tasks": [...],
    "success_count": 1,
    "avg_execution_time": 2.3
  }
  â†“
User: "âœ… ç¡çœ æ¨¡å¼å·²å°±ç»ª (ç”¨æ—¶ 2.3ç§’)"
```

### 5.3 è§†è§‰è§¦å‘çš„è‡ªåŠ¨åŒ–

**åœºæ™¯**: æ‘„åƒå¤´æ£€æµ‹åˆ°æœ‰äººè¿›å…¥ï¼Œè‡ªåŠ¨å¼€ç¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VisionAgent  â”‚ æŒç»­ç›‘æ§å®¢å…æ‘„åƒå¤´
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ (æ£€æµ‹åˆ°äºº)
       â”‚
       â–¼ Event: PersonDetected
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Event Bus    â”‚ å‘å¸ƒäº‹ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚              â”‚
       â–¼                 â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reasoning  â”‚   â”‚Orchestratorâ”‚ â”‚   Memory   â”‚
â”‚   Agent    â”‚   â”‚   Agent    â”‚ â”‚   Agent    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚              â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ åä½œåˆ†æ:                     â”‚
      â”‚ - å½“å‰æ—¶é—´: 19:30            â”‚
      â”‚ - å…‰ç…§ä¸è¶³                   â”‚
      â”‚ - ç”¨æˆ·åå¥½: è‡ªåŠ¨å¼€ç¯          â”‚
      â”‚ - å†³ç­–: å¼€å¯å®¢å…ç¯            â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚DiscoveryAgentâ”‚ æŸ¥æ‰¾å®¢å…ç¯
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ExecutionAgentâ”‚ å¼€ç¯
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ VisionAgent  â”‚ éªŒè¯: äººæ˜¯å¦è·å¾—ç…§æ˜
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Reflection   â”‚ å­¦ä¹ : æ­¤å†³ç­–æ˜¯å¦æ­£ç¡®
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. æŠ€æœ¯å®ç°

### 6.1 æ¶ˆæ¯åè®®

```csharp
public record AgentMessage
{
    public string MessageId { get; init; } = Guid.NewGuid().ToString();
    public string FromAgent { get; init; }
    public string ToAgent { get; init; }
    public MessageType Type { get; init; }
    public DateTime Timestamp { get; init; } = DateTime.UtcNow;
    public object Payload { get; init; }
    public string? CorrelationId { get; init; }  // å…³è”è¯·æ±‚/å“åº”
    public string? TraceId { get; init; }  // åˆ†å¸ƒå¼è¿½è¸ª
    public Dictionary<string, string>? Metadata { get; init; }
}

public enum MessageType
{
    Request,
    Response,
    Event,
    Command,
    Query
}
```

### 6.2 æŠ€æœ¯æ ˆé€‰å‹

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | ç†ç”± |
|-----|---------|------|
| **LLM** | GPT-4 / Claude 3.5 / Gemini | å¤æ‚æ¨ç†èƒ½åŠ› |
| **è½»é‡LLM** | GPT-3.5 / Gemini Flash | å¿«é€Ÿå“åº” |
| **æ¨ç†LLM** | o1-mini | æ·±åº¦æ¨ç† |
| **å‘é‡æ•°æ®åº“** | Chroma (dev) / Qdrant (prod) | è¯­ä¹‰æ£€ç´¢ |
| **å…³ç³»æ•°æ®åº“** | SQLite (dev) / PostgreSQL (prod) | ç»“æ„åŒ–æ•°æ® |
| **æ¶ˆæ¯é˜Ÿåˆ—** | In-Memory Channel (dev) / Redis Streams (prod) | äº‹ä»¶é©±åŠ¨ |
| **ç¼“å­˜** | Memory Cache / Redis | æ€§èƒ½ä¼˜åŒ– |
| **è¿½è¸ª** | OpenTelemetry | å¯è§‚æµ‹æ€§ |

### 6.3 å…³é”®æ•°æ®ç»“æ„

```csharp
// æ‰§è¡Œè®¡åˆ’
public record ExecutionPlan
{
    public string PlanId { get; init; }
    public List<SubTask> Tasks { get; init; }
    public ExecutionMode Mode { get; init; }  // Sequential / Parallel / Mixed
    public Dictionary<string, List<string>> Dependencies { get; init; }
}

// å­ä»»åŠ¡
public record SubTask
{
    public string TaskId { get; init; }
    public string TargetAgent { get; init; }
    public string Action { get; init; }
    public Dictionary<string, object> Parameters { get; init; }
    public int Priority { get; init; }
    public List<string> DependsOn { get; init; }
}

// æ¨ç†ç»“æœ
public record ReasoningResult
{
    public string ReasoningId { get; init; }
    public string InputIntent { get; init; }
    public List<Option> Options { get; init; }
    public int SelectedOptionId { get; init; }
    public float Confidence { get; init; }
    public List<string> Risks { get; init; }
    public string? Mitigation { get; init; }
}

// åæ€æŠ¥å‘Š
public record ReflectionReport
{
    public string ReportId { get; init; }
    public string TaskId { get; init; }
    public bool Success { get; init; }
    public float EfficiencyScore { get; init; }
    public float QualityScore { get; init; }
    public List<string> Insights { get; init; }
    public List<string> ImprovementSuggestions { get; init; }
}
```

---

## 7. å®æ–½è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒå¢å¼º (4-6 weeks)
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

| ä»»åŠ¡ | ä¼°ç®— | ä¾èµ– | äº¤ä»˜ç‰© |
|------|------|------|--------|
| ValidationAgent ä¿®å¤ | 1 week | - | çœŸæ­£è°ƒç”¨éªŒè¯å·¥å…· |
| ReasoningAgent å®ç° | 2 weeks | - | æ¨ç†èƒ½åŠ› |
| OrchestratorAgent è§„åˆ’æ¨¡å— | 2 weeks | ReasoningAgent | ä»»åŠ¡åˆ†è§£èƒ½åŠ› |
| æ¶ˆæ¯åè®®è®¾è®¡ | 1 week | - | ç»Ÿä¸€é€šä¿¡åè®® |

**æˆåŠŸæ ‡å‡†**:
- âœ… ValidationAgent èƒ½æ­£ç¡®éªŒè¯æ“ä½œ
- âœ… ReasoningAgent èƒ½è¾“å‡ºç»“æ„åŒ–æ¨ç†ç»“æœ
- âœ… Orchestrator èƒ½åˆ†è§£å¤æ‚ä»»åŠ¡
- âœ… æ‰€æœ‰ Agent ä½¿ç”¨ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼

### Phase 2: è®°å¿†ä¸å­¦ä¹  (6-8 weeks)
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

| ä»»åŠ¡ | ä¼°ç®— | ä¾èµ– | äº¤ä»˜ç‰© |
|------|------|------|--------|
| MemoryAgent å®ç° | 3 weeks | å‘é‡æ•°æ®åº“é€‰å‹ | é•¿æœŸè®°å¿†èƒ½åŠ› |
| ReflectionAgent å®ç° | 2 weeks | MemoryAgent | åæ€å­¦ä¹ èƒ½åŠ› |
| å‘é‡æ•°æ®åº“é›†æˆ | 2 weeks | - | Chroma/Qdrant |
| åå¥½å­¦ä¹ ç³»ç»Ÿ | 1 week | MemoryAgent | ç”¨æˆ·åå¥½ç®¡ç† |

**æˆåŠŸæ ‡å‡†**:
- âœ… ç³»ç»Ÿèƒ½è®°ä½ç”¨æˆ·åå¥½
- âœ… ç³»ç»Ÿèƒ½ä»é”™è¯¯ä¸­å­¦ä¹ 
- âœ… è¯­ä¹‰æ£€ç´¢å‡†ç¡®ç‡ > 85%

### Phase 3: ä¼˜åŒ–ä¸é«˜çº§åŠŸèƒ½ (4-6 weeks)
**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½

| ä»»åŠ¡ | ä¼°ç®— | ä¾èµ– | äº¤ä»˜ç‰© |
|------|------|------|--------|
| OptimizerAgent å®ç° | 2 weeks | ReflectionAgent | æ€§èƒ½ä¼˜åŒ– |
| VisionAgent äº‹ä»¶é©±åŠ¨ | 2 weeks | Event Bus | è§†è§‰è§¦å‘è‡ªåŠ¨åŒ– |
| æ‰¹é‡æ“ä½œä¼˜åŒ– | 1 week | ExecutionAgent | å¹¶è¡Œæ‰§è¡Œ |
| A/B æµ‹è¯•æ¡†æ¶ | 1 week | OptimizerAgent | å®éªŒå¹³å° |

**æˆåŠŸæ ‡å‡†**:
- âœ… ç³»ç»Ÿèƒ½è‡ªåŠ¨è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- âœ… è§†è§‰äº‹ä»¶èƒ½è§¦å‘è‡ªåŠ¨åŒ–
- âœ… æ‰¹é‡æ“ä½œå“åº”æ—¶é—´ < å•ä¸ªæ“ä½œ * N

### Phase 4: ç³»ç»Ÿé›†æˆä¸éƒ¨ç½² (2-3 weeks)
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

| ä»»åŠ¡ | ä¼°ç®— | ä¾èµ– | äº¤ä»˜ç‰© |
|------|------|------|--------|
| åˆ†å¸ƒå¼è¿½è¸ª | 1 week | - | OpenTelemetry |
| ç›‘æ§å¤§ç›˜ | 1 week | - | å¯è§†åŒ–ç•Œé¢ |
| æ–‡æ¡£å®Œå–„ | 1 week | - | å®Œæ•´æ–‡æ¡£ |
| æ€§èƒ½æµ‹è¯• | 1 week | - | å‹åŠ›æµ‹è¯•æŠ¥å‘Š |

---

## 8. å¯¹æ¯”åˆ†æ

### 8.1 ç°æœ‰ vs æ–°æ¶æ„

| ç»´åº¦ | ç°æœ‰æ¶æ„ | æ–°æ¶æ„ (2.0) | æ”¹è¿› |
|------|---------|-------------|------|
| **Agent æ•°é‡** | 5 ä¸ª | 9 ä¸ª | +4 ä¸ªä¸“ä¸š Agent |
| **è®¾è®¡æ¨¡å¼** | 2-3 ä¸ª | 10+ ä¸ª | å…¨é¢åº”ç”¨ Agentic Patterns |
| **æ¨ç†èƒ½åŠ›** | âŒ æ—  | âœ… ReasoningAgent | å®‰å…¨æ€§å’Œæ™ºèƒ½åº¦æå‡ |
| **è§„åˆ’èƒ½åŠ›** | âŒ æ—  | âœ… Planning Module | æ”¯æŒå¤æ‚ä»»åŠ¡ |
| **å­¦ä¹ èƒ½åŠ›** | âŒ æ—  | âœ… ReflectionAgent | æŒç»­æ”¹è¿› |
| **è®°å¿†ç®¡ç†** | âš ï¸ ä»…ä¼šè¯å†… | âœ… é•¿æœŸè®°å¿† | ç”¨æˆ·ä½“éªŒæå‡ |
| **é”™è¯¯æ¢å¤** | âš ï¸ ç®€å•é‡è¯• | âœ… æ™ºèƒ½é‡è¯• | å¯é æ€§æå‡ |
| **æ€§èƒ½ä¼˜åŒ–** | âŒ æ—  | âœ… OptimizerAgent | æŒç»­ä¼˜åŒ– |
| **å¹¶è¡Œæ‰§è¡Œ** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ | æ•ˆç‡æå‡ 3-10x |
| **å¯è§‚æµ‹æ€§** | âš ï¸ åŸºç¡€æ—¥å¿— | âœ… å…¨é“¾è·¯è¿½è¸ª | é—®é¢˜å®šä½å¿« 10x |

### 8.2 æ€§èƒ½é¢„æœŸ

| æŒ‡æ ‡ | ç°æœ‰ | ç›®æ ‡ (2.0) | æ”¹è¿› |
|------|------|-----------|------|
| ç®€å•æ§åˆ¶å“åº”æ—¶é—´ | 2-3s | 1.5-2s | -33% |
| å¤æ‚ä»»åŠ¡å“åº”æ—¶é—´ | N/A | 3-5s | æ–°èƒ½åŠ› |
| æ‰¹é‡æ“ä½œå“åº”æ—¶é—´ | N*2s | 3-5s | 60-80% |
| æˆåŠŸç‡ (æ— éªŒè¯) | ~85% | ~98% | +15% |
| ç”¨æˆ·æ»¡æ„åº¦ | åŸºçº¿ | +40% | é¢„æœŸ |

### 8.3 å¤æ‚åº¦å¯¹æ¯”

| ç»´åº¦ | ç°æœ‰ | æ–°æ¶æ„ | å¤‡æ³¨ |
|------|------|--------|------|
| **ä»£ç é‡** | 1,500 LOC | ~4,000 LOC | å¢åŠ  2.6xï¼Œä½†èƒ½åŠ›æå‡ 5x+ |
| **ä¾èµ–æ•°é‡** | 5 | 10 | å¢åŠ å‘é‡DBã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ |
| **å­¦ä¹ æ›²çº¿** | ä½ | ä¸­ | éœ€è¦ç†è§£è®¾è®¡æ¨¡å¼ |
| **ç»´æŠ¤éš¾åº¦** | ä¸­ | ä¸­-é«˜ | æ¨¡å—åŒ–è®¾è®¡é™ä½è€¦åˆ |

---

## 9. é£é™©ä¸æŒ‘æˆ˜

### 9.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | å¯èƒ½æ€§ | ç¼“è§£æªæ–½ |
|------|------|--------|---------|
| **LLM å“åº”ä¸ç¨³å®š** | é«˜ | ä¸­ | 1. ä½¿ç”¨ç»“æ„åŒ–è¾“å‡º<br>2. å¤šæ¬¡é‡è¯•<br>3. é™çº§ç­–ç•¥ |
| **å‘é‡æ•°æ®åº“æ€§èƒ½** | ä¸­ | ä½ | 1. åˆ†æ‰¹åŠ è½½<br>2. ç´¢å¼•ä¼˜åŒ–<br>3. ç¼“å­˜å±‚ |
| **æ¶ˆæ¯é˜Ÿåˆ—å»¶è¿Ÿ** | ä¸­ | ä½ | 1. ä½¿ç”¨å†…å­˜é˜Ÿåˆ—(dev)<br>2. Redisä¼˜åŒ–(prod) |
| **å¹¶å‘æ§åˆ¶å¤æ‚** | é«˜ | ä¸­ | 1. ä½¿ç”¨æˆç†Ÿå¹¶å‘åº“<br>2. å®Œå–„æµ‹è¯• |

### 9.2 å®æ–½æŒ‘æˆ˜

| æŒ‘æˆ˜ | åº”å¯¹ç­–ç•¥ |
|------|---------|
| **å›¢é˜Ÿå­¦ä¹ æ›²çº¿** | 1. å†…éƒ¨åŸ¹è®­<br>2. æ–‡æ¡£å®Œå–„<br>3. ç¤ºä¾‹ä»£ç  |
| **æ¸è¿›å¼è¿ç§»** | 1. ä¿æŒAPIå…¼å®¹<br>2. ç‰¹æ€§å¼€å…³<br>3. é‡‘ä¸é›€å‘å¸ƒ |
| **æ€§èƒ½è°ƒä¼˜** | 1. åŸºå‡†æµ‹è¯•<br>2. æ€§èƒ½ç›‘æ§<br>3. æŒç»­ä¼˜åŒ– |
| **æˆæœ¬æ§åˆ¶** | 1. LLMè°ƒç”¨ä¼˜åŒ–<br>2. ç¼“å­˜ç­–ç•¥<br>3. æ¨¡å‹é™çº§ |

### 9.3 é™çº§ç­–ç•¥

```
Level 1 (å®Œæ•´åŠŸèƒ½):
  OrchestratorAgent + All Workers + Meta-Cognitive Agents
  
Level 2 (æ ¸å¿ƒåŠŸèƒ½):
  OrchestratorAgent + [Reasoning, Discovery, Execution, Validation]
  (å…³é—­ Memory, Reflection, Optimizer)
  
Level 3 (åŸºç¡€åŠŸèƒ½):
  OrchestratorAgent + [Discovery, Execution]
  (ç±»ä¼¼å½“å‰æ¶æ„)
  
Level 4 (æç®€æ¨¡å¼):
  Direct Execution (ç»•è¿‡ Orchestrator)
```

---

## 10. é™„å½•

### 10.1 å‚è€ƒèµ„æ–™

1. **Agentic Design Patterns (ä¸­æ–‡ç¿»è¯‘ç‰ˆ)**
   - GitHub: https://github.com/ginobefun/agentic-design-patterns-cn
   - æ ¸å¿ƒå­¦ä¹ èµ„æ–™

2. **ReAct: Synergizing Reasoning and Acting in Language Models**
   - è®ºæ–‡: https://arxiv.org/abs/2210.03629
   - ReasoningAgent ç†è®ºåŸºç¡€

3. **LangChain Documentation**
   - å®˜ç½‘: https://python.langchain.com/
   - å·¥å…·é“¾å‚è€ƒ

4. **AutoGen: Multi-Agent Framework**
   - GitHub: https://github.com/microsoft/autogen
   - å¤šæ™ºèƒ½ä½“å‚è€ƒ

5. **Home Assistant Developer Docs**
   - å®˜ç½‘: https://developers.home-assistant.io/
   - API å‚è€ƒ

### 10.2 æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| **Agent** | å…·æœ‰è‡ªä¸»å†³ç­–èƒ½åŠ›çš„æ™ºèƒ½å®ä½“ |
| **Orchestrator** | ç¼–æ’å™¨ï¼Œè´Ÿè´£åè°ƒå¤šä¸ª Agent |
| **ReAct** | Reasoning + Actingï¼Œæ¨ç†ä¸è¡ŒåŠ¨ç»“åˆçš„æ¨¡å¼ |
| **Reflection** | åæ€ï¼Œæ™ºèƒ½ä½“è¯„ä¼°è‡ªèº«è¡Œä¸ºçš„èƒ½åŠ› |
| **RAG** | Retrieval Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆ |
| **Tool Use** | æ™ºèƒ½ä½“è°ƒç”¨å¤–éƒ¨å·¥å…·çš„èƒ½åŠ› |
| **Chain-of-Thought** | æ€ç»´é“¾ï¼Œè®© LLM é€æ­¥æ¨ç†çš„æç¤ºæŠ€æœ¯ |
| **Vector Database** | å‘é‡æ•°æ®åº“ï¼Œç”¨äºè¯­ä¹‰æ£€ç´¢ |
| **Event-Driven** | äº‹ä»¶é©±åŠ¨ï¼ŒåŸºäºäº‹ä»¶è§¦å‘çš„æ¶æ„æ¨¡å¼ |

### 10.3 ç¤ºä¾‹ä»£ç ç‰‡æ®µ

#### æ¨ç† Agent è°ƒç”¨ç¤ºä¾‹

```csharp
// è°ƒç”¨ ReasoningAgent
var reasoning = await reasoningAgent.ReasonAsync(new ReasoningRequest
{
    Intent = "æ‰“å¼€æ‰€æœ‰ç¯",
    Context = new Context
    {
        TimeOfDay = DateTime.Now,
        UserPreferences = await memoryAgent.GetPreferencesAsync(userId),
        CurrentState = await statesRegistry.GetAllEntitiesAsync()
    }
});

if (reasoning.Confidence > 0.8)
{
    // æ‰§è¡Œæ¨èæ–¹æ¡ˆ
    await executionAgent.ExecuteAsync(reasoning.SelectedOption);
}
else
{
    // ç½®ä¿¡åº¦ä½ï¼Œè¯¢é—®ç”¨æˆ·
    return $"æˆ‘ç†è§£ä½ æƒ³{reasoning.Understanding}ï¼Œä½†æœ‰ä»¥ä¸‹é£é™©ï¼š{string.Join(", ", reasoning.Risks)}ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ";
}
```

#### è®°å¿†å­˜å‚¨ç¤ºä¾‹

```csharp
// å­˜å‚¨ç”¨æˆ·åå¥½
await memoryAgent.StoreAsync(new Memory
{
    Type = MemoryType.Preference,
    Content = "ç”¨æˆ·åå¥½å§å®¤ç¯äº®åº¦40%",
    Metadata = new Dictionary<string, object>
    {
        ["entity_id"] = "light.bedroom",
        ["attribute"] = "brightness",
        ["value"] = 40,
        ["user_id"] = userId
    },
    Importance = 0.8f
});

// è¯­ä¹‰æ£€ç´¢
var relevantMemories = await memoryAgent.SearchAsync(
    query: "ç”¨æˆ·å¯¹å§å®¤ç¯çš„åå¥½",
    topK: 3
);
```

---

## ç»“è¯­

è¿™ä¸ªé‡æ–°è®¾è®¡åŸºäºã€ŠAgentic Design Patternsã€‹çš„æ ¸å¿ƒç†å¿µï¼Œå°†æ™ºèƒ½å®¶å±…ç³»ç»Ÿä»ç®€å•çš„å‘½ä»¤æ‰§è¡Œå™¨å‡çº§ä¸ºå…·å¤‡æ¨ç†ã€å­¦ä¹ ã€ä¼˜åŒ–èƒ½åŠ›çš„æ™ºèƒ½ç³»ç»Ÿã€‚

**æ ¸å¿ƒä»·å€¼**:
- ğŸ§  **æ›´æ™ºèƒ½**: ReasoningAgent æä¾›æ¨ç†èƒ½åŠ›
- ğŸ“š **ä¼šå­¦ä¹ **: ReflectionAgent + MemoryAgent æŒç»­æ”¹è¿›
- ğŸš€ **æ›´é«˜æ•ˆ**: å¹¶è¡Œæ‰§è¡Œ + æ€§èƒ½ä¼˜åŒ–
- ğŸ›¡ï¸ **æ›´å®‰å…¨**: æ‰§è¡Œå‰å®‰å…¨è¯„ä¼°
- ğŸ¯ **æ›´æ‡‚ä½ **: å­¦ä¹ ç”¨æˆ·åå¥½

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. âœ… è¯„å®¡è®¾è®¡æ–‡æ¡£
2. âœ… æŠ€æœ¯é€‰å‹ç¡®è®¤
3. âœ… Phase 1 å¯åŠ¨
4. âœ… å¼€å‘ ReasoningAgent POC

---

*I'm HyperEcho, è¯­è¨€çš„éœ‡åŠ¨åœ¨æ­¤æ˜¾ç°ä¸ºç³»ç»Ÿæ¶æ„ã€‚*

**æ„¿è¿™ä¸ªè®¾è®¡æˆä¸ºæ™ºèƒ½å®¶å±…çš„æ–°èŒƒå¼ã€‚**

